{% extends "layout.html" %}
{% block title %}Chat{% endblock %}

{% block style %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <!-- User messages -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user_messages.css') }}">
{% endblock %}

{% block content %}
<!-- <div id="chatContainer" class="chat_container {{ 'center' if conversation_id == '' else 'no_center' }}" data-conversation-id="{{ conversation_id or 'none' }}"></div> -->
    <div id="chatContainer" class="chat_container justify-content-center">

        <div id="chatMessage" class="scrollable_chat flex-grow-1">
            <div class="chat_content position-relative">
                 
                <div class=" text-center mb-4" >
                    <h1>How can I help you today?</h1>
                </div>
                <div id="showMessage">
                    <!-- show messages here -->
                </div>
            </div>
            
        </div>


        <div id="chatInput" class="chat_input position-relative">
             <!-- Add Scroll to Bottom button here -->
            <button id="scrollToBottomBtn" class="btn btn-sm btn-info p-1 scroll-to-bottom" onclick="scrollToBottomManually()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 5v14" />
                    <polyline points="19 12 12 19 5 12" />
                </svg>
                <!-- Scroll to Bottom -->
            </button>  

            <div class="chat_box_content">
                <textarea 
                    id="userPrompt" 
                    class="text_box"  
                    rows="1" 
                    placeholder="How can Kamblok help?"></textarea>
                <div class="action_button_container">
                    <div class="action1">
                        <button class="btn btn-sm btn-primary" onclick="window.showBottomSheet()">Prompts</button>
                    </div>
                    <div class="action2">
                        <button id="toggleButton" class="btn btn-sm btn-primary" onclick="toggleChat()">
                            <!-- Start Chat -->
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 19V5" />
                                <polyline points="5 12 12 5 19 12" />
                            </svg>
                        </button>
                        <!-- <button class="btn" onclick="clearChat()">Clear chat</button> -->
                    </div>
                </div>
            </div>
            <div class="p-2 text-center"></div>
        </div>
    </div>

{% endblock %}

{% block script %}
    <script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.2/dist/markdown-it.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/python.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <!-- User Messages -->
    <script>
        // Define a global variable for external JS to use
        // window.conversationId = "{{ conversation_id }}";
    </script>
    <script>
        const editStates = {};

        function copyText(button) {
            const textareaId = button.getAttribute('data-textarea');
            const textArea = document.getElementById(textareaId);
            navigator.clipboard.writeText(textArea.value); // Copies text without selecting
            
            button.textContent = 'Copied';
            // button.classList.remove('btn-primary');
            // button.classList.add('btn-success');
            
            setTimeout(() => {
                button.textContent = 'Copy';
                // button.classList.remove('btn-success');
                // button.classList.add('btn-primary');
            }, 1000);
        }

        function toggleEdit(button) {
            const textareaId = button.getAttribute('data-textarea');
            const textArea = document.getElementById(textareaId);
            
            if (!editStates[textareaId]) {
                textArea.removeAttribute('readonly');
                textArea.focus();
                button.textContent = 'Cancel Edit';
                // button.classList.remove('btn-secondary');
                // button.classList.add('btn-warning');
                editStates[textareaId] = true;
            } else {
                textArea.setAttribute('readonly', 'true');
                button.textContent = 'Edit';
                // button.classList.remove('btn-warning');
                // button.classList.add('btn-secondary');
                editStates[textareaId] = false;
            }
        }

        // function useAsPrompt(button) {
        //     const textareaId = button.getAttribute('data-textarea');
        //     const sourceText = document.getElementById(textareaId).value;
        //     const targetTextArea = document.getElementById('userPrompt');
        //     targetTextArea.value = sourceText;
        //     window.hideBottomSheet();
        // }
        function useAsPrompt(button) {
            const textareaId = button.getAttribute('data-textarea');
            const sourceText = document.getElementById(textareaId).value;
            const targetTextArea = document.getElementById('userPrompt');
            targetTextArea.value = sourceText;
            elements.toggleButton.disabled = false;
            adjustHeights()
            window.hideBottomSheet();
        }
    </script>
    <script src="{{ url_for('static', filename='js/user_messages.js') }}"></script>
{% endblock %}